---
# Base Image
ee_base_image: registry.redhat.io/ansible-automation-platform-25/ee-minimal-rhel9:latest
# download from access.redhat.com -> Downloads -> OpenShift Container Platform -> Packages
ocp_rpm_name: "openshift-clients-4.17.0-202412120604.p0.gf4525b8.assembly.stream.el9.x86_64.rpm"

ee_list:
  - name: ee-mitchell-labs-default
    tag: "{{ now(fmt='%m-%d-%Y') }}"
    build_items:
      - "{{ ocp_rpm_name }}"
    build_files:
      - src: "{{ ocp_rpm_name }}"
        dest: rpms
    build_steps:
      prepend_base:
        - RUN $PYCMD -m pip install --upgrade pip setuptools
        # dependencies for redhat.openshift_virtualization
        - COPY _build/rpms/openshift-clients*.rpm /tmp/openshift-clients.rpm
        - RUN $PKGMGR -y update && $PKGMGR -y install bash-completion && $PKGMGR clean all
        - RUN rpm -ivh /tmp/openshift-clients.rpm && rm /tmp/openshift-clients.rpm
    dependencies:
      python_interpreter:
        python_path: "/usr/bin/python3.11"
      system:
        - python3-devel
      galaxy:
        collections:
          #General
          - name: community.general
          # AAP
          - name: ansible.controller
          - name: ansible.platform
          # OCP
          - name: redhat.openshift_virtualization
          # Windows
          - name: microsoft.ad
          - name: chocolatey.chocolatey
          - name: ansible.windows
